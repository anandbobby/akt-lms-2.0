/**
 * Certificate block.
 *
 * @package     local_edwiserreports
 * @copyright   2022 Wisdmlabs <support@wisdmlabs.com>
 * @author      Yogesh Shirsath
 * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */ define("local_edwiserreports/blocks/certificatestats",["jquery","local_edwiserreports/defaultconfig","local_edwiserreports/common",],function(t,e,a){var r={PANEL:"#certificatesblock",COHORT:".cohort-select",TABLE:"#certificatesblock table",SEARCH:".table-search-input input",USERS:"#certificatesblock table a.modal-trigger",FORMFILTER:'#certificatesblock .download-links [name="filter"]'},i={cohort:0,dir:t("html").attr("dir")},l=null;let o={GET_CERTIFICATES:function(a){return t.ajax({url:e.requestUrl,type:e.requestType,dataType:e.requestDataType,data:{action:"get_certificates_data_ajax",secret:M.local_edwiserreports.secret,lang:t("html").attr("lang"),data:JSON.stringify({filter:a})}})}};function n(){a.loader.show(r.PANEL),o.GET_CERTIFICATES(i).done(function(e){null!==l&&l.destroy(),l=t(r.TABLE).DataTable({responsive:!0,data:e.data,dom:'<"edwiserreports-table"<t><"table-pagination"p>>',columns:[{data:"name"},{data:"coursename"},{data:"issued"},{data:"notissued"}],columnDefs:[{targets:[0,1],className:"text-left"},{targets:"_all",className:"text-center"}],language:{info:M.util.get_string("tableinfo","local_edwiserreports"),infoEmpty:M.util.get_string("infoempty","local_edwiserreports"),emptyTable:M.util.get_string("nocertificates","local_edwiserreports"),zeroRecords:M.util.get_string("zerorecords","local_edwiserreports"),paginate:{previous:" ",next:" "}},drawCallback:function(){a.stylePaginationButton(this)},lengthChange:!1,bInfo:!1})}).fail(function(t){console.log(t)}).always(function(){a.loader.hide(r.PANEL)})}return{init:function e(a){0!==t(r.PANEL).length&&(t(r.FORMFILTER).val(JSON.stringify(i)),t(r.PANEL).find(".singleselect").select2(),n(),t("body").on("change",`${r.PANEL} ${r.COHORT}`,function(){let e=t(this).val();i.cohort=e,t(r.PANEL).find('.download-links input[name="cohortid"]').val(e),n()}),t("body").on("input",`${r.PANEL} ${r.SEARCH}`,function(){l.columns(0).search(t(this).val()).draw()}))}}});
