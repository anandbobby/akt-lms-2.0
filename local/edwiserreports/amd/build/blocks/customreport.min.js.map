{"version":3,"sources":["blocks/customreport.js"],"names":["define","$","Notification","common","CFG","PROMISE","GET_DATA","params","ajax","url","requestUrl","type","requestType","dataType","requestDataType","data","action","secret","M","local_edwiserreports","lang","attr","init","id","document","ready","tableId","concat","searchTable","setupBlockEditing","loader","show","closest","done","response","success","JSON","parse","table","DataTable","columns","dom","reportsdata","bInfo","lengthChange","language","info","util","get_string","infoEmpty","emptyTable","zeroRecords","paginate","previous","next","drawCallback","stylePaginationButton","this","on","search","value","draw","setTimeout","css","border-left","border-bottom","border-top","border-left-color","border-right-width","border-right","border-right-color","border-left-width","empty","hide","fail","exception","_init"],"mappings":"AAAA,aAyBAA,OAAO,2CAA4C,CAAC,SAAU,oBAAqB,YAAa,oBAAqB,SAAUC,EAAGC,EAAcC,EAAQC,GAItJ,IAAIC,EAAU,CACZC,SAAU,SAAkBC,GAC1B,OAAON,EAAEO,KAAK,CACZC,IAAKL,EAAIM,WACTC,KAAMP,EAAIQ,YACVC,SAAUT,EAAIU,gBACdC,KAAM,CACJC,OAAQ,8BACRC,OAAQC,EAAEC,qBAAqBF,OAC/BG,KAAMnB,EAAE,QAAQoB,KAAK,QACrBN,KAAMR,OAgFd,MAAO,CACLe,KAAM,SAAcC,EAAIhB,GACtBN,EAAEuB,UAAUC,MAAM,YAvEtB,SAAeF,EAAIhB,GACjB,IAAImB,EAAU,IAAIC,OAAOJ,EAAI,2BACzBK,EAAc,IAAID,OAAOJ,EAAI,+BAGjCpB,EAAO0B,kBAAkB,6BACzB1B,EAAO2B,OAAOC,KAAK9B,EAAEyB,GAASM,QAAQ,+BACtC3B,EAAQC,SAASC,GAAQ0B,KAAK,SAAUC,GACtC,GAAIA,EAASC,QAAS,CACpB,IAAIpB,EAAOqB,KAAKC,MAAMH,EAASnB,MAC3BuB,EAAQrC,EAAEyB,GAASa,UAAU,CAC/BC,QAASzB,EAAKyB,QACdC,IAAK,kEACL1B,KAAMA,EAAK2B,YACXC,OAAO,EACPC,cAAc,EACdC,SAAU,CACRC,KAAM5B,EAAE6B,KAAKC,WAAW,YAAa,wBACrCC,UAAW/B,EAAE6B,KAAKC,WAAW,YAAa,wBAC1CE,WAAYhC,EAAE6B,KAAKC,WAAW,SAAU,wBACxCG,YAAajC,EAAE6B,KAAKC,WAAW,cAAe,wBAC9CI,SAAU,CACRC,SAAU,IACVC,KAAM,MAGVC,aAAc,WACZpD,EAAOqD,sBAAsBC,SAKjCxD,EAAE,QAAQyD,GAAG,QAAS9B,EAAa,WACjCU,EAAMqB,OAAOF,KAAKG,OAAOC,SAK7BC,WAAW,WACT,IAAIzC,EAAOpB,EAAE,QAAQoB,KAAK,YAGN,IAATA,IAAiC,IAATA,GAA0B,OAARA,IACnDpB,EAAE,kDAAkD8D,IAAI,CACtDC,cAAe,yBACfC,gBAAiB,wBACjBC,aAAc,wBACdC,oBAAqB,OACrBC,qBAAsB,QAExBnE,EAAE,sDAAsD8D,IAAI,CAC1DE,gBAAiB,wBACjBC,aAAc,wBACdG,eAAgB,0BAChBC,qBAAsB,OACtBC,oBAAqB,UAGxB,KAGHT,WAAW,WAET7D,EAAE,2CAA2CuE,QAC7CvE,EAAE,+CAA+CuE,SAChD,KACHrE,EAAO2B,OAAO2C,KAAKxE,EAAEyB,GAASM,QAAQ,iCACrC0C,KAAKxE,EAAayE,WAKjBC,CAAMrD,EAAIhB","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Custom Report block.\n *\n * @package     local_edwiserreports\n * @copyright   2022 Wisdmlabs <support@wisdmlabs.com>\n * @author      Yogesh Shirsath\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine('local_edwiserreports/blocks/customreport', [\n    'jquery',\n    'core/notification',\n    '../common',\n    '../defaultconfig'\n], function(\n    $,\n    Notification,\n    common,\n    CFG\n) {\n\n    /**\n     * Promise list to fetch data.\n     */\n    let PROMISE = {\n        GET_DATA: function(params) {\n            return $.ajax({\n                url: CFG.requestUrl,\n                type: CFG.requestType,\n                dataType: CFG.requestDataType,\n                data: {\n                    action: 'get_customreports_data_ajax',\n                    secret: M.local_edwiserreports.secret,\n                    lang: $('html').attr('lang'),\n                    data: params\n                }\n            });\n        }\n    };\n\n    /**\n     * Initialise custom report block\n     * @param {String} id Block id\n     * @param {String} params Report parameters\n     */\n    function init(id, params) {\n        var tableId = `#${id} table.customreportdata`;\n        var searchTable = `#${id}  .table-search-input input`;\n\n        // Calling common blocks editing function to show change capability popup\n        common.setupBlockEditing('.erp-custom-edit-settings');\n\n        common.loader.show($(tableId).closest('[id^=\"customreportsblock\"]'));\n        PROMISE.GET_DATA(params)\n            .done(function(response) {\n                if (response.success) {\n                    var data = JSON.parse(response.data);\n                    var table = $(tableId).DataTable({\n                        columns: data.columns,\n                        dom: '<\"edwiserreports-table\"<\"table-wrapper\"t><\"table-pagination\"p>>',\n                        data: data.reportsdata,\n                        bInfo: false,\n                        lengthChange: false,\n                        language: {\n                            info: M.util.get_string('tableinfo', 'local_edwiserreports'),\n                            infoEmpty: M.util.get_string('infoempty', 'local_edwiserreports'),\n                            emptyTable: M.util.get_string('nodata', 'local_edwiserreports'),\n                            zeroRecords: M.util.get_string('zerorecords', 'local_edwiserreports'),\n                            paginate: {\n                                previous: \" \",\n                                next: \" \"\n                            }\n                        },\n                        drawCallback: function() {\n                            common.stylePaginationButton(this);\n                        }\n                    });\n\n                    // Search in table.\n                    $('body').on('input', searchTable, function() {\n                        table.search(this.value).draw();\n                    });\n                }\n\n                // RTL support for arrows\n                setTimeout(function(){\n                    var attr = $('html').attr('dir');\n                    // For some browsers, `attr` is undefined; for others,\n                    // `attr` is false.  Check for both.\n                    if (typeof attr !== 'undefined' && attr !== false && attr == 'rtl') {\n                        $('.edwiserreports-table .page-item.next a:before').css({'border-left': '11px solid transparent', 'border-bottom': '6px solid transparent','border-top': '6px solid transparent','border-left-color': '#ccc','border-right-width': '0px'});\n                        $('.edwiserreports-table .page-item.previous a:before').css({'border-bottom': '6px solid transparent','border-top': '6px solid transparent','border-right':' 10px solid transparent','border-right-color': '#ccc','border-left-width': '0px'});\n                    }\n                }, 1000);\n\n                // all themes support for arrows\n                setTimeout(function(){\n                    // removing datatbles next previous blank as it can not be done by thier attributes\n                    $('.edwiserreports-table .page-item.next a').empty();\n                    $('.edwiserreports-table .page-item.previous a').empty();\n        \n                }, 2000);\n\n\n                common.loader.hide($(tableId).closest('[id^=\"customreportsblock\"]'));\n            }).fail(Notification.exception);\n    }\n\n    return {\n        init: function(id, params) {\n            $(document).ready(function() {\n                init(id, params);\n            });\n        }\n    }\n});\n"],"file":"customreport.min.js"}
